!function(){"use strict";!function(){const t="Portugal";var e=class{constructor(t){this.tradeURL=t,this.width=900,this.height=600,this.svg=d3.select("#world").append("svg").attr("width",this.width).attr("height",this.height).append("g"),this.projection=d3.geoMercator().translate([this.width/2,this.height/1.5]).scale(144),this.path=d3.geoPath().projection(this.projection),this.worldMap=this._fetchWorldMap(),this.trades=this._fetchTrades()}render(){this.worldMap.then((t=>{let e=this,r=topojson.feature(t,t.objects.countries).features;this.trades.then((function(t){e.svg.selectAll(".country").data(r).enter().append("path").attr("class","country").attr("d",e.path).on("mouseover",(function(r){e.mouseOverCountry(r,this,t)})).on("mousemove",(function(t){e.mouseMove(t,this)})).on("mouseout",(function(t){e.mouseOutCountry(t,this)}));const n=t.slice(0,10).map((t=>t.partner));e._renderTradePartners(n),e.rangeSlider=new class{constructor(t){this.trades=t;const e=Math.ceil(this.trades[10].amount);this.range=[0,e],this.barChart=new class{constructor(t,e){this.trades=t,this.range=e,this.margin={top:20,right:90,bottom:80,left:180},this.width=900-this.margin.left-this.margin.right,this.height=450-this.margin.top-this.margin.bottom}render(t){d3.select("#bar-chart").select("svg").remove(),this.svg=d3.select("#bar-chart").append("svg").attr("width",900).attr("height",450).append("g").attr("transform",`translate(${this.margin.left}, ${this.margin.top})`),this.range=t;const e=this.trades.filter((t=>this.range[0]<=t.amount&&t.amount<=this.range[1])).map((t=>({partner:t.partner,amount:t.amount})));e.sort((function(t,e){return t.amount<e.amount?1:t.amount>e.amount?-1:0}));const r=e.length>10?e.slice(0,10):e,n=d3.scaleLinear().domain([0,this.range[1]]).range([0,this.width]);this.svg.append("g").attr("transform",`translate(0, ${this.height})`).call(d3.axisBottom(n)).selectAll("text").attr("transform","translate(-10,0)rotate(-45)").style("text-anchor","end").style("font-size","13px");const s=d3.scaleBand().range([0,this.height]).domain(r.map((t=>t.partner))).padding(.4);this.svg.append("g").call(d3.axisLeft(s)).style("font-size","15px"),this.svg.selectAll("myRect").data(r).join("rect").attr("x",n(0)).attr("y",(t=>s(t.partner))).attr("width",0).transition().duration(1e3).delay((function(t,e){return 50*e})).attr("width",(t=>n(t.amount))).attr("height",s.bandwidth()).attr("fill","#ffa876"),this.svg.append("text").attr("x",this.width/2).attr("y",this.height+70).attr("text-anchor","middle").text("Trade Amount (US$ Thousand)")}}(this.trades,this.range);let r=this;this.slider=d3.sliderBottom().min(d3.min(this.range)).max(d3.max(this.range)).width(935).tickFormat(d3.format(",.0f")).ticks(10).default([this.range[0],this.range[1]]).handle(d3.symbol().type(d3.symbolCircle).size(200)).fill("#5c9946").on("onchange",(function(t){r.range=t,r._renderTradePartnersWithinRange(),r.barChart.render(t)})),this.gRange=d3.select("#range-slider").append("svg").attr("width",1e3).attr("height",90).append("g").attr("transform","translate(30,30)")}render(){this.gRange.call(this.slider),d3.select("p#value-range").text(this.slider.value().map(d3.format(",.0f")).join("-"))}_renderTradePartnersWithinRange(){d3.selectAll(".country").classed("selected-by-range-top-10",!1),d3.selectAll(".country").classed("selected-by-range",!1);const t=d3.selectAll(".country"),e=[];this.trades.forEach((r=>{this.range[0]<=r.amount&&r.amount<=this.range[1]&&t.each((function(t,n){const s=t.properties.name;r.partner===s&&e.push(this)}))})),e.forEach(((t,e)=>{e<10?d3.select(t).classed("selected-by-range-top-10",!0):d3.select(t).classed("selected-by-range",!0)}))}}(t),e.rangeSlider.render()}))}))}mouseOverCountry(t,e,r){d3.select(e).classed("mouseover",!0).style("display: block");const n=t.properties.name;for(let t=0;t<r.length;t++){const e=r[t];if(e.partner===n){d3.select("#world-tooltip").style("display","inline").insert("div").classed("world-tooltip-content",!0),d3.select(".world-tooltip-content").html(e.toHTML());break}}}mouseOutCountry(t,e){d3.select(e).classed("mouseover",!1).style("display: none"),d3.select("#world-tooltip").style("display","none"),d3.selectAll(".world-tooltip-content").remove()}mouseMove(t,e){d3.select("#world-tooltip").style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}async _fetchWorldMap(){return await d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")}async _fetchTrades(){const e=await d3.json(this.tradeURL),r=[];return this.worldMap.then((n=>{let s=topojson.feature(n,n.objects.countries).features.map((t=>t.properties.name));return e.Partner.forEach((e=>{const n=e["Partner Name"].trim(),a=s.find((t=>{if(t.includes(n)||n.includes(t))return t}));if(void 0!==a){let n=e["Export (US$ Thousand)"]||e["Import (US$ Thousand)"];r.push(new class{constructor(e,r,n,s,a){this.origin=t,this.partner=e.trim(),this.year=parseInt(r.trim()),this.tradeFlow=n.trim(),this.productGroup=s.trim(),this.amount=parseFloat(a.trim())}toHTML(){return`<ul>\n                    <li>In ${this.year}</li>\n                    <li>${this.productGroup}</li>\n                    <li>${this.tradeFlow} ${"Export"===this.tradeFlow?"to":"from"} ${this.partner}</li>\n                    <li>Trade Amount $${(1e3*this.amount).toLocaleString("en-US")}</li>\n                </ul>`}}(a,e.Year,e["Trade Flow"],e["Product Group"],n))}})),r.sort((function(t,e){return t.amount<e.amount?1:t.amount>e.amount?-1:0})),r}))}_renderTradePartners(e){d3.selectAll(".country").each((function(r,n){const s=r.properties.name;e.some((function(t){return t===s}))&&d3.select(this).classed("selected-top-10",!0),s===t&&d3.select(this).classed("origin",!0)}))}};const r="https://qyhappacademy.github.io/portugal_trade_data_visualization/data/exports.json",n="https://qyhappacademy.github.io/portugal_trade_data_visualization/data/imports.json";document.addEventListener("DOMContentLoaded",(()=>{!function(){const t=document.getElementById("user-guide-modal");document.getElementById("user-guide-button").addEventListener("click",(e=>{e.preventDefault(),t.style.display="block"})),document.getElementsByClassName("close")[0].addEventListener("click",(e=>{e.preventDefault(),t.style.display="none"})),window.addEventListener("click",(e=>{e.target==t&&(t.style.display="none")}))}();let t=new e(n);t.render();const s=document.getElementById("toggle-trade-button");s.addEventListener("click",(a=>{a.preventDefault(),s.children[0].children[0].innerText=t.tradeURL===r?"To Exports":"To Imports",document.getElementById("world").innerHTML="",document.getElementById("world-tooltip").innerHTML="",document.getElementById("range-slider").innerHTML="",document.getElementById("bar-chart").innerHTML="",t=t.tradeURL===r?new e(n):new e(r),t.render()}))}))}()}();
//# sourceMappingURL=main.js.map